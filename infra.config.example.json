{
  "$schema": "./infra.config.schema.json",
  "_comment": "Infrastructure configuration for Dashborion deployment",
  "_modes": {
    "standalone": "SST creates all resources (S3, CloudFront, Lambda role) - for dev/testing",
    "semi-managed": "SST creates frontend (S3, CloudFront), Lambda uses external role",
    "managed": "SST syncs to existing S3/CloudFront, Lambda uses external role"
  },

  "mode": "semi-managed",

  "aws": {
    "_comment": "AWS provider configuration - uses env vars AWS_REGION/AWS_PROFILE if not set",
    "region": "eu-west-3",
    "profile": "dashborion-shared-services/AdministratorAccess"
  },

  "auth": {
    "_comment": "Native SSO authentication with Lambda@Edge",
    "enabled": true,
    "provider": "saml",
    "saml": {
      "_comment": "SAML IdP configuration (AWS Identity Center / Microsoft Entra ID)",
      "entityId": "dashborion",
      "idpMetadataUrl": "https://portal.sso.eu-west-3.amazonaws.com/saml/metadata/...",
      "acsPath": "/saml/acs",
      "metadataPath": "/saml/metadata"
    },
    "sessionTtlSeconds": 3600,
    "cookieDomain": ".homebox.kamorion.cloud",
    "excludedPaths": ["/health", "/api/health", "/saml/metadata"],
    "requireMfaForProduction": true,
    "_permissionsNote": "Permissions table names are auto-generated as dashborion-{stage}-permissions/audit"
  },

  "lambda": {
    "_comment": "Required for semi-managed and managed modes",
    "roleArn": "arn:aws:iam::123456789012:role/dashborion-lambda-role"
  },

  "frontend": {
    "_comment": "Required only for managed mode - SST syncs to existing bucket",
    "s3Bucket": "dashborion-frontend-123456789012",
    "cloudfrontDistributionId": "E1234567890ABC",
    "cloudfrontDomain": "dashboard.example.com"
  },

  "apiGateway": {
    "_comment": "Optional: if set, SST uses existing API Gateway instead of creating one",
    "id": null,
    "url": null
  },

  "crossAccountRoles": {
    "_comment": "Roles to access resources in other AWS accounts (created via Terraform module)",
    "staging": {
      "accountId": "111111111111",
      "readRoleArn": "arn:aws:iam::111111111111:role/dashborion-read-role",
      "actionRoleArn": "arn:aws:iam::111111111111:role/dashborion-action-role"
    },
    "preprod": {
      "accountId": "222222222222",
      "readRoleArn": "arn:aws:iam::222222222222:role/dashborion-read-role",
      "actionRoleArn": "arn:aws:iam::222222222222:role/dashborion-action-role"
    },
    "production": {
      "accountId": "333333333333",
      "readRoleArn": "arn:aws:iam::333333333333:role/dashborion-read-role",
      "actionRoleArn": "arn:aws:iam::333333333333:role/dashborion-action-role"
    }
  },

  "projects": {
    "_comment": "Projects configuration for multi-tenant authorization",
    "homebox": {
      "displayName": "Homebox",
      "environments": ["staging", "preprod", "production"],
      "_roleMapping": {
        "_comment": "IdP groups mapped to Dashborion roles",
        "dashborion-homebox-viewer": { "role": "viewer", "env": "*" },
        "dashborion-homebox-operator": { "role": "operator", "env": "*" },
        "dashborion-homebox-admin": { "role": "admin", "env": "*" },
        "dashborion-homebox-prod-operator": { "role": "operator", "env": "production" }
      }
    }
  }
}
